<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module C2A - Gestion des Achats Automatiques</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #17a2b8;
        }

        body {
            background: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .header h1 {
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .tab {
            padding: 12px 25px;
            background: #f8f9fa;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            color: var(--primary);
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: var(--secondary);
            color: white;
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
        }

        .card-change {
            font-size: 14px;
            color: var(--success);
            margin-top: 5px;
        }

        .card-change.negative {
            color: var(--danger);
        }

        /* Main Content */
        .content-section {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f1f1;
        }

        .section-header h2 {
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .product-card {
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }

        .product-card:hover {
            border-color: var(--secondary);
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .product-card.out-of-stock {
            border-color: var(--danger);
            background: #fff5f5;
        }

        .product-card.low-stock {
            border-color: var(--warning);
            background: #fff9e6;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .product-code {
            background: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .product-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-out {
            background: #f8d7da;
            color: #721c24;
        }

        .status-low {
            background: #fff3cd;
            color: #856404;
        }

        .product-info {
            margin-bottom: 15px;
        }

        .product-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .product-category {
            color: #7f8c8d;
            font-size: 14px;
        }

        .stock-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .stock-item {
            text-align: center;
        }

        .stock-label {
            font-size: 12px;
            color: #7f8c8d;
        }

        .stock-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
        }

        .supplier-info {
            background: #e8f4fc;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .supplier-name {
            font-weight: bold;
            color: var(--primary);
        }

        .purchase-controls {
            display: flex;
            gap: 10px;
        }

        .quantity-control {
            flex: 1;
            display: flex;
            align-items: center;
            border: 2px solid #ddd;
            border-radius: 6px;
            overflow: hidden;
        }

        .qty-btn {
            padding: 10px 15px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-weight: bold;
            color: var(--primary);
        }

        .qty-input {
            flex: 1;
            border: none;
            text-align: center;
            padding: 10px;
            font-size: 16px;
        }

        .add-btn {
            padding: 10px 20px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Shopping Cart */
        .cart-section {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }

        .cart-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .cart-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            color: var(--primary);
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }

        .cart-table td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
        }

        .remove-btn {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }

        .cart-summary {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .summary-row.total {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 600px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--primary);
            font-weight: 600;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* Alert */
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-warehouse"></i> Module C2A - Gestion des Achats Automatiques</h1>
            <p>Système de réapprovisionnement automatique basé sur les seuils de stock</p>
            
            <div class="tabs">
                <button class="tab active" data-tab="purchase">Achats Automatiques</button>
                <button class="tab" data-tab="bill">Création BILL</button>
                <button class="tab" data-tab="rules">Règles de Stock</button>
                <button class="tab" data-tab="history">Historique</button>
            </div>
        </div>

        <!-- Dashboard Cards -->
        <div class="dashboard-cards">
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-exclamation-triangle" style="color: var(--danger);"></i>
                        <span>Produits en Rupture</span>
                    </div>
                    <div class="card-value">12</div>
                </div>
                <div class="card-change negative">+2 depuis hier</div>
                <div style="margin-top: 15px; font-size: 14px; color: #7f8c8d;">
                    Nécessitent achat urgent
                </div>
            </div>
            
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-shopping-cart" style="color: var(--warning);"></i>
                        <span>Commandes en Cours</span>
                    </div>
                    <div class="card-value">8</div>
                </div>
                <div class="card-change">+1 aujourd'hui</div>
                <div style="margin-top: 15px; font-size: 14px; color: #7f8c8d;">
                    En attente de validation
                </div>
            </div>
            
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-money-bill-wave" style="color: var(--success);"></i>
                        <span>Budget Restant</span>
                    </div>
                    <div class="card-value">45,230 €</div>
                </div>
                <div class="card-change negative">-2,450 € cette semaine</div>
                <div style="margin-top: 15px; font-size: 14px; color: #7f8c8d;">
                    Budget mensuel: 50,000 €
                </div>
            </div>
        </div>

        <!-- Alert -->
        <div class="alert alert-warning">
            <i class="fas fa-robot"></i>
            <div>
                <strong>Système Automatique Actif:</strong> Les achats sont générés automatiquement en fonction des seuils de stock. 
                Vérification hebdomadaire programmée pour le vendredi à 17:00.
            </div>
        </div>

        <!-- Automatic Purchase Section -->
        <div class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-robot"></i> Produits à Réapprovisionner</h2>
                <div>
                    <button class="btn btn-warning" onclick="runAutomaticCheck()">
                        <i class="fas fa-sync-alt"></i> Vérification Manuelle
                    </button>
                    <button class="btn btn-success" onclick="generatePurchaseList()" style="margin-left: 10px;">
                        <i class="fas fa-file-export"></i> Générer Liste d'Achat
                    </button>
                </div>
            </div>

            <div class="products-grid" id="productsGrid">
                <!-- Produit 1 -->
                <div class="product-card out-of-stock">
                    <div class="product-header">
                        <span class="product-code">MED-045</span>
                        <span class="product-status status-out">RUPTURE</span>
                    </div>
                    <div class="product-info">
                        <div class="product-name">Amoxicilline 250mg</div>
                        <div class="product-category">Médicament - Antibiotique</div>
                    </div>
                    <div class="stock-info">
                        <div class="stock-item">
                            <div class="stock-label">Stock Actuel</div>
                            <div class="stock-value" style="color: var(--danger);">0</div>
                        </div>
                        <div class="stock-item">
                            <div class="stock-label">Seuil Minimum</div>
                            <div class="stock-value">30</div>
                        </div>
                        <div class="stock-item">
                            <div class="stock-label">Besoin</div>
                            <div class="stock-value">50</div>
                        </div>
                    </div>
                    <div class="supplier-info">
                        <div class="supplier-name">Fournisseur: PharmaPlus S.A.</div>
                        <div style="font-size: 14px;">Prix unitaire: 2.50 €</div>
                        <div style="font-size: 14px;">Délai livraison: 2-3 jours</div>
                    </div>
                    <div class="purchase-controls">
                        <div class="quantity-control">
                            <button class="qty-btn" onclick="decreaseQty('MED-045')">-</button>
                            <input type="text" class="qty-input" id="qty-MED-045" value="50" readonly>
                            <button class="qty-btn" onclick="increaseQty('MED-045')">+</button>
                        </div>
                        <button class="add-btn" onclick="addToCart('MED-045')">
                            <i class="fas fa-cart-plus"></i> Ajouter
                        </button>
                    </div>
                </div>

                <!-- Produit 2 -->
                <div class="product-card low-stock">
                    <div class="product-header">
                        <span class="product-code">CON-012</span>
                        <span class="product-status status-low">STOCK BAS</span>
                    </div>
                    <div class="product-info">
                        <div class="product-name">Seringues 10ml</div>
                        <div class="product-category">Consommable Médical</div>
                    </div>
                    <div class="stock-info">
                        <div class="stock-item">
                            <div class="stock-label">Stock Actuel</div>
                            <div class="stock-value" style="color: var(--warning);">45</div>
                        </div>
                        <div class="stock-item">
                            <div class="stock-label">Seuil Minimum</div>
                            <div class="stock-value">100</div>
                        </div>
                        <div class="stock-item">
                            <div class="stock-label">Besoin</div>
                            <div class="stock-value">200</div>
                        </div>
                    </div>
                    <div class="supplier-info">
                        <div class="supplier-name">Fournisseur: MedEquip Co.</div>
                        <div style="font-size: 14px;">Prix unitaire: 0.35 €</div>
                        <div style="font-size: 14px;">Délai livraison: 1-2 jours</div>
                    </div>
                    <div class="purchase-controls">
                        <div class="quantity-control">
                            <button class="qty-btn" onclick="decreaseQty('CON-012')">-</button>
                            <input type="text" class="qty-input" id="qty-CON-012" value="200" readonly>
                            <button class="qty-btn" onclick="increaseQty('CON-012')">+</button>
                        </div>
                        <button class="add-btn" onclick="addToCart('CON-012')">
                            <i class="fas fa-cart-plus"></i> Ajouter
                        </button>
                    </div>
                </div>

                <!-- Produit 3 -->
                <div class="product-card out-of-stock">
                    <div class="product-header">
                        <span class="product-code">MED-128</span>
                        <span class="product-status status-out">RUPTURE</span>
                    </div>
                    <div class="product-info">
                        <div class="product-name">Insuline Glargine</div>
                        <div class="product-category">Médicament - Diabète</div>
                    </div>
                    <div class="stock-info">
                        <div class="stock-item">
                            <div class="stock-label">Stock Actuel</div>
                            <div class="stock-value" style="color: var(--danger);">0</div>
                        </div>
                        <div class="stock-item">
                            <div class="stock-label">Seuil Minimum</div>
                            <div class="stock-value">25</div>
                        </div>
                        <div class="stock-item">
                            <div class="stock-label">Besoin</div>
                            <div class="stock-value">40</div>
                        </div>
                    </div>
                    <div class="supplier-info">
                        <div class="supplier-name">Fournisseur: BioPharma Ltd.</div>
                        <div style="font-size: 14px;">Prix unitaire: 15.75 €</div>
                        <div style="font-size: 14px;">Délai livraison: 3-5 jours</div>
                    </div>
                    <div class="purchase-controls">
                        <div class="quantity-control">
                            <button class="qty-btn" onclick="decreaseQty('MED-128')">-</button>
                            <input type="text" class="qty-input" id="qty-MED-128" value="40" readonly>
                            <button class="qty-btn" onclick="increaseQty('MED-128')">+</button>
                        </div>
                        <button class="add-btn" onclick="addToCart('MED-128')">
                            <i class="fas fa-cart-plus"></i> Ajouter
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Shopping Cart -->
        <div class="cart-section">
            <div class="section-header">
                <h2><i class="fas fa-shopping-cart"></i> Panier d'Achat</h2>
                <div>
                    <button class="btn btn-danger" onclick="clearCart()">
                        <i class="fas fa-trash"></i> Vider le Panier
                    </button>
                    <button class="btn btn-primary" onclick="createBill()" style="margin-left: 10px;">
                        <i class="fas fa-file-invoice-dollar"></i> Créer le BILL
                    </button>
                </div>
            </div>

            <table class="cart-table">
                <thead>
                    <tr>
                        <th>Code Produit</th>
                        <th>Description</th>
                        <th>Fournisseur</th>
                        <th>Quantité</th>
                        <th>Prix Unitaire</th>
                        <th>Total</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="cartItems">
                    <!-- Les articles du panier seront ajoutés ici dynamiquement -->
                </tbody>
            </table>

            <div class="cart-summary">
                <div class="summary-row">
                    <span>Sous-total</span>
                    <span id="subtotal">0.00 €</span>
                </div>
                <div class="summary-row">
                    <span>TVA (20%)</span>
                    <span id="tax">0.00 €</span>
                </div>
                <div class="summary-row">
                    <span>Frais de livraison</span>
                    <span>250.00 €</span>
                </div>
                <div class="summary-row total">
                    <span>Total Général</span>
                    <span id="total">0.00 €</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour Création de BILL -->
    <div id="billModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-file-invoice-dollar"></i> Création du BILL</h2>
                <button class="close-modal" onclick="closeBillModal()">&times;</button>
            </div>
            
            <form id="billForm">
                <div class="form-group">
                    <label>Numéro BILL (Auto-généré)</label>
                    <input type="text" value="BILL-2024-00158" readonly>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Date de création</label>
                        <input type="date" value="2024-06-17" required>
                    </div>
                    <div class="form-group">
                        <label>Date limite de livraison</label>
                        <input type="date" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Fournisseur Principal</label>
                    <select required>
                        <option value="">Sélectionner un fournisseur</option>
                        <option>PharmaPlus S.A.</option>
                        <option>MedEquip Co.</option>
                        <option>BioPharma Ltd.</option>
                        <option>HealthSupplies Inc.</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Mode de Paiement</label>
                    <select required>
                        <option value="">Sélectionner un mode</option>
                        <option>Virement Bancaire</option>
                        <option>Chèque</option>
                        <option>Espèces</option>
                        <option>M-Vola</option>
                        <option>Orange Money</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Notes (optionnel)</label>
                    <textarea rows="4" placeholder="Notes additionnelles pour ce BILL..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Documents joints</label>
                    <input type="file" multiple>
                </div>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;">
                    <div class="summary-row">
                        <span>Total BILL:</span>
                        <span id="modalTotal" style="font-weight: bold; font-size: 18px;">0.00 €</span>
                    </div>
                    <div style="font-size: 12px; color: #7f8c8d; margin-top: 10px;">
                        Ce total doit correspondre au total UBS pour validation
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-check-circle"></i> Créer le BILL
                    </button>
                    <button type="button" class="btn" onclick="closeBillModal()" style="flex: 1;">
                        <i class="fas fa-times"></i> Annuler
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Variables globales
        let cart = [];
        let products = {
            'MED-045': { name: 'Amoxicilline 250mg', price: 2.50, supplier: 'PharmaPlus S.A.' },
            'CON-012': { name: 'Seringues 10ml', price: 0.35, supplier: 'MedEquip Co.' },
            'MED-128': { name: 'Insuline Glargine', price: 15.75, supplier: 'BioPharma Ltd.' }
        };

        // Navigation par onglets
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                const tabName = this.dataset.tab;
                showTab(tabName);
            });
        });

        function showTab(tabName) {
            alert(`Affichage de l'onglet: ${tabName}`);
            // Ici, vous chargeriez le contenu de l'onglet sélectionné
        }

        // Gestion des quantités
        function decreaseQty(productCode) {
            const input = document.getElementById(`qty-${productCode}`);
            let value = parseInt(input.value);
            if (value > 1) {
                input.value = value - 1;
            }
        }

        function increaseQty(productCode) {
            const input = document.getElementById(`qty-${productCode}`);
            let value = parseInt(input.value);
            input.value = value + 1;
        }

        // Gestion du panier
        function addToCart(productCode) {
            const qtyInput = document.getElementById(`qty-${productCode}`);
            const quantity = parseInt(qtyInput.value);
            
            const product = products[productCode];
            const totalPrice = product.price * quantity;
            
            // Vérifier si le produit est déjà dans le panier
            const existingIndex = cart.findIndex(item => item.code === productCode);
            
            if (existingIndex > -1) {
                cart[existingIndex].quantity += quantity;
                cart[existingIndex].total = cart[existingIndex].quantity * product.price;
            } else {
                cart.push({
                    code: productCode,
                    name: product.name,
                    supplier: product.supplier,
                    quantity: quantity,
                    price: product.price,
                    total: totalPrice
                });
            }
            
            updateCartDisplay();
            alert(`Produit ajouté au panier: ${product.name} (${quantity} unités)`);
        }

        function removeFromCart(productCode) {
            cart = cart.filter(item => item.code !== productCode);
            updateCartDisplay();
        }

        function clearCart() {
            if (confirm('Voulez-vous vider le panier ?')) {
                cart = [];
                updateCartDisplay();
            }
        }

        function updateCartDisplay() {
            const cartItems = document.getElementById('cartItems');
            const subtotalEl = document.getElementById('subtotal');
            const taxEl = document.getElementById('tax');
            const totalEl = document.getElementById('total');
            const modalTotalEl = document.getElementById('modalTotal');
            
            // Vider le tableau
            cartItems.innerHTML = '';
            
            let subtotal = 0;
            
            // Ajouter chaque article
            cart.forEach(item => {
                subtotal += item.total;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.code}</td>
                    <td>${item.name}</td>
                    <td>${item.supplier}</td>
                    <td>${item.quantity}</td>
                    <td>${item.price.toFixed(2)} €</td>
                    <td>${item.total.toFixed(2)} €</td>
                    <td>
                        <button class="remove-btn" onclick="removeFromCart('${item.code}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                cartItems.appendChild(row);
            });
            
            // Calculer les totaux
            const tax = subtotal * 0.20;
            const delivery = 250.00;
            const total = subtotal + tax + delivery;
            
            // Mettre à jour les affichages
            subtotalEl.textContent = subtotal.toFixed(2) + ' €';
            taxEl.textContent = tax.toFixed(2) + ' €';
            totalEl.textContent = total.toFixed(2) + ' €';
            modalTotalEl.textContent = total.toFixed(2) + ' €';
            
            // Afficher un message si le panier est vide
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #7f8c8d;">
                            <i class="fas fa-shopping-cart" style="font-size: 48px; margin-bottom: 15px; display: block;"></i>
                            Votre panier est vide
                        </td>
                    </tr>
                `;
            }
        }

        // Fonctions diverses
        function runAutomaticCheck() {
            alert('Lancement de la vérification automatique des stocks...\nAnalyse en cours.');
        }

        function generatePurchaseList() {
            if (cart.length === 0) {
                alert('Veuillez d\'abord ajouter des produits au panier.');
                return;
            }
            alert('Génération de la liste d\'achat...\nDocument PDF créé.');
        }

        function createBill() {
            if (cart.length === 0) {
                alert('Le panier est vide. Ajoutez des produits avant de créer un BILL.');
                return;
            }
            document.getElementById('billModal').style.display = 'flex';
        }

        function closeBillModal() {
            document.getElementById('billModal').style.display = 'none';
        }

        // Soumission du formulaire BILL
        document.getElementById('billForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const billNumber = this.querySelector('input[type="text"]').value;
            alert(`BILL ${billNumber} créé avec succès !\nEnvoi en cours pour validation UBS...`);
            closeBillModal();
            
            // Réinitialiser le panier
            cart = [];
            updateCartDisplay();
        });

        // Initialiser l'affichage du panier
        updateCartDisplay();

        // Fermer la modale en cliquant à l'extérieur
        window.onclick = function(event) {
            const modal = document.getElementById('billModal');
            if (event.target === modal) {
                closeBillModal();
            }
        }
    </script>
</body>
</html>